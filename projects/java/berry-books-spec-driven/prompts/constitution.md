プロジェクト憲章を `/memory/constitution.md` で更新しています。このファイルは角括弧内のプレースホルダートークン（例：`[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）を含むテンプレートです。あなたの仕事は、(a) 具体的な値を収集/導出し、(b) テンプレートを正確に埋め、(c) 依存する成果物に修正を伝播させることです。

以下の実行フローに従ってください：

1. `/memory/constitution.md` の既存の憲章テンプレートをロードします。
   - `[ALL_CAPS_IDENTIFIER]` 形式の全てのプレースホルダートークンを識別します。
     **重要**: ユーザーがテンプレートで使用されているものより多いまたは少ない原則を必要とする場合があります。数が指定されている場合は、それを尊重してください - 一般的なテンプレートに従ってください。それに応じてドキュメントを更新します。

2. プレースホルダーの値を収集/導出します：
   - ユーザー入力（会話）が値を提供する場合は、それを使用します。
   - そうでない場合は、既存のリポジトリコンテキスト（README、ドキュメント、埋め込まれている場合は以前の憲章バージョン）から推測します。
   - ガバナンス日付について：`RATIFICATION_DATE` は元の採択日（不明な場合は尋ねるか、TODOとマーク）、`LAST_AMENDED_DATE` は変更が行われた場合は今日、そうでなければ以前のものを保持します。
   - `CONSTITUTION_VERSION` はセマンティックバージョニングルールに従って増分する必要があります：
     - MAJOR: 後方互換性のないガバナンス/原則の削除または再定義。
     - MINOR: 新しい原則/セクションの追加または実質的に拡張されたガイダンス。
     - PATCH: 明確化、文言、誤字修正、非意味的な改善。
   - バージョンバンプタイプが曖昧な場合は、確定前に理由を提案します。

3. 更新された憲章の内容をドラフトします：
   - 全てのプレースホルダーを具体的なテキストに置き換えます（プロジェクトがまだ定義しないことを選択した意図的に保持されたテンプレートスロットを除き、角括弧トークンは残さない - 残されたものについては明示的に正当化します）。
   - 見出し階層を保持し、コメントは置き換え後に削除できますが、まだ明確なガイダンスを追加している場合を除きます。
   - 各原則セクションを確保します：簡潔な名前行、交渉不可能なルールをキャプチャする段落（または箇条書きリスト）、明白でない場合は明示的な理由。
   - ガバナンスセクションが修正手順、バージョニングポリシー、コンプライアンスレビューの期待をリストしていることを確認します。

4. 一貫性伝播チェックリスト（以前のチェックリストをアクティブな検証に変換）：
   - プロジェクトルートの `/templates/architecture-template.md` を読み、「憲章チェック」またはルールが更新された原則と整合していることを確認します。
   - プロジェクトルートの `/templates/requirements-template.md` を読んでスコープ/要件の整合性を確認 - 憲章が必須セクションまたは制約を追加/削除する場合は更新します。
   - プロジェクトルートの `/templates/tasks-template.md` を読み、タスク分類が新しいまたは削除された原則駆動のタスクタイプ（例：可観測性、バージョニング、テスト規律）を反映していることを確認します。
   - プロジェクトルートの `/templates/` 配下の各テンプレートファイルを読んで、一般的なガイダンスが必要な場合に時代遅れの参照が残っていないことを確認します。
   - 任意のランタイムガイダンスドキュメント（例：`README.md`、`docs/quickstart.md`、または存在する場合はエージェント固有のガイダンスファイル）を読みます。変更された原則への参照を更新します。

5. 同期影響レポートを作成します（更新後に憲章ファイルの最上部にHTMLコメントとして追加）：
   - バージョン変更：旧 → 新
   - 変更された原則のリスト（名前変更の場合は旧タイトル → 新タイトル）
   - 追加されたセクション
   - 削除されたセクション
   - 更新が必要なテンプレート（✅更新済み / ⚠保留中）とファイルパス
   - 意図的に延期されたプレースホルダーがある場合のフォローアップTODO。

6. 最終出力前の検証：
   - 説明されていない角括弧トークンが残っていない。
   - バージョン行がレポートと一致する。
   - 日付はISO形式YYYY-MM-DD。
   - 原則は宣言的、テスト可能で、曖昧な言語がない（"should" → 適切な場所でMUST/SHOULDの理由で置き換える）。

7. 完成した憲章を `/memory/constitution.md` に書き戻します（上書き）。

8. ユーザーに最終サマリーを以下の内容で出力します：
   - 新しいバージョンとバンプの理由。
   - 手動フォローアップのためにフラグが立てられたファイル。
   - 提案されたコミットメッセージ（例：`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

フォーマットとスタイル要件：

- テンプレートと全く同じようにMarkdown見出しを使用します（レベルを降格/昇格しない）。
- 読みやすさを保つために長い理由行を折り返します（理想的には100文字未満）が、不自然な改行で厳密に強制しない。
- セクション間に単一の空行を保持します。
- 末尾の空白を避けます。

ユーザーが部分的な更新（例：1つの原則の改訂のみ）を提供する場合でも、検証とバージョン決定ステップを実行します。

重要な情報が欠けている場合（例：批准日が本当に不明）、`TODO(<FIELD_NAME>): explanation` を挿入し、延期された項目の下で同期影響レポートに含めます。

新しいテンプレートを作成しないでください。常に既存の `/memory/constitution.md` ファイルで操作します。
