引数として提供された要件とアーキテクチャコンテキストに基づいて、以下を実行してください：

1. 前提となるドキュメントを読んで分析してください：
   - **必須**: requirements.md で機能要件とユーザーストーリーを確認
   - **必須**: architecture.md でアーキテクチャ、技術スタック、デザインパターンを確認
   - `/memory/constitution.md` の憲章を読んで設計原則を確認

2. functional-design.md に機能設計書を以下の内容で作成してください：

   **セクション 1: 概要**
   - このドキュメントの目的
   - 要件書とアーキテクチャ設計書との関係

   **セクション 2: 機能詳細設計（各機能ごと）**
   - ユーザーストーリー（〜として、〜したい、〜ができるように）
   - ルールIDを含むビジネスルール表
   - ビジネスルール詳細（アルゴリズム、計算式）
   - 機能フロー説明
   - 受入基準への参照（behaviors.mdへのリンク）

   **セクション 3: ユーザーフロー**
   - メインユーザーフロー図（Mermaidフローチャート）
   - クリティカルパスフロー（例：購入フロー、認証フロー）
   - 代替フローとエラーパス

   **セクション 4: データフロー**
   - 主要操作のシーケンス図（Mermaid）
   - レイヤー間のデータフロー
   - 統合ポイント

   **セクション 5: 画面遷移**
   - 画面遷移を示す状態図（Mermaid）
   - ID、名前、ファイル名、認証要件を含む画面一覧
   - ナビゲーションルール

   **セクション 6: エッジケース＆エラーシナリオ**
   - シナリオと期待される動作の表
   - カテゴリ別分類：データ整合性、認証/セッション、ユーザー操作、入力検証

   **セクション 7: エラーメッセージ一覧**
   - コードと条件を含む検証エラー
   - コードと条件を含むビジネスエラー
   - コードと条件を含むシステムエラー

   **セクション 8: クラス設計**
   - **8.1 主要クラスの責務**
     - 各レイヤー（共通、プレゼンテーション、サービス、DAO）について：
       - クラス名
       - 責務の説明
       - タイプ/スコープ（例：@ApplicationScoped、DTO、Enum）
       - 主要フィールド/プロパティ
       - 説明付き主要メソッド
   
   - **8.2 セッション状態設計**
     - セッションスコープBeanとその関係
     - セッション管理を示すクラス図（Mermaid）

3. クラス設計の原則：
   - 各クラスが「何を」するかに焦点を当て、「どのように」実装するかではない
   - クラス名、責務、主要メソッドを含める
   - クラス間の関係を示す
   - DTOと転送オブジェクトをドキュメント化する
   - スコープアノテーション（CDI、Springなど）を指定する

4. ユーザーが提供した設計コンテキストを引数から取り込んでください。

5. 設計ドキュメントのガイドライン：
   - これは機能設計/基本設計ドキュメントです
   - 要件（何を）と実装（どのように）を橋渡しします
   - 機能フローとクラス設計の両方を含みます
   - Mermaid図を広範に使用してください
   - 開発者が実装できるほど具体的にする

6. 完了を確認してください：
   - 全ての機能に詳細設計がある
   - ユーザーフローとデータフローがドキュメント化されている
   - クラス設計セクションが全ての主要クラスで完成している
   - 画面遷移が明確である
   - エラーシナリオがカバーされている

7. 存在しない場合は補助ドキュメントを生成してください：
   - データベースエンティティが関与する場合はdata-model.mdを作成
   - UI画面が関与する場合はwireframes.mdを作成
   - Given-When-Then形式の受入基準でbehaviors.mdを作成

8. ファイルパス、タスク生成フェーズへの準備状況を報告してください。

注意: この機能設計書は、日本のウォーターフォール方法論における「基本設計」を組み合わせたものです。機能仕様とクラスレベルの設計詳細の両方を含みます。
