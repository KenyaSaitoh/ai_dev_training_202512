# コード生成インストラクション

## 使用方法

```
@instructions/generate_code.md このインストラクションに従って、
プロジェクトルート: @<プロジェクトルートのパス>
タスクリスト: @<タスクファイルのパス>
に基づいて実装を進めてください。
```

**例（ベースプロジェクト・単独実装）:**
```
@instructions/generate_code.md このインストラクションに従って、
プロジェクトルート: @projects/java/berry-books-mvc-sdd
タスクリスト: @projects/java/berry-books-mvc-sdd/tasks/tasks.md
に基づいて実装を進めてください。

セットアップタスクから順に実行してください。
```

**例（ベースプロジェクト・並行実装）:**
```
@instructions/generate_code.md このインストラクションに従って、
プロジェクトルート: @projects/java/berry-books-mvc-sdd
タスクリスト: @projects/java/berry-books-mvc-sdd/tasks/feature_f001_book_search.md
に基づいて実装を進めてください。

注意: 共通機能タスク（common_tasks.md）の完了を待ってから開始してください。
```

**例（拡張）:**
```
@instructions/generate_code.md このインストラクションに従って、
プロジェクトルート: @projects/java/berry-books-mvc-sdd
タスクリスト: @projects/java/berry-books-mvc-sdd/specs/enhancements/202512_inventory_alert/tasks/tasks.md
に基づいて実装を進めてください。

このタスクのみを実行し、完了したら停止してください。
注意: 既存コードの修正は慎重に行い、既存機能に影響を与えないようにしてください。
```

---

## 実装の実行

**重要: 指定されたタスクファイルのタスクのみを実行し、完了したら停止してください。次のタスクに自動的に進んではいけません。**

現在の機能コンテキストに基づいて、以下を実行してください：

1. 実装コンテキストをロードして分析してください：
   - **最優先**: `<プロジェクトルート>/memory/` 配下の憲章ファイルでプロジェクトの開発原則、アーキテクチャ方針、品質基準、組織標準を確認
   - **必須**: 指定されたタスクリストで完全なタスクリストと実行計画を確認
   - **必須**: requirements.md で機能要件と成功基準を確認
   - **必須**: architecture_design.md で技術スタック、アーキテクチャ、デザインパターンを確認
   - **必須**: functional_design.md でクラス設計、メソッド、機能フローを確認
   - **存在する場合**: data_model.md（データモデル仕様書）でエンティティと関係を確認
   - **存在する場合**: screen_design.md（画面仕様書）でUI設計とレイアウト仕様を確認
   - **存在する場合**: behaviors.md（振る舞い仕様書）で受入基準とテストシナリオを確認
   - **存在する場合**: external_interface.md（外部インターフェース仕様書）で外部連携仕様とAPI仕様（OpenAPI YAML含む）を確認
   - **存在する場合**: research.md で技術的決定と制約を確認
   - **存在する場合**: quickstart.md で結合シナリオを確認
   - **画像リソース**: `<プロジェクトルート>/images/` フォルダ（特に images/covers/）の画像ファイルを確認し、セットアップ時に適切な場所にコピー
   
   **注意**: プロジェクトルートは外部から明示的に指定されます。全てのパスはそのプロジェクトルートを基準とした相対パスです。

2. tasks.md構造を解析して抽出してください：
   - **タスク構成**: セットアップ、共通機能、機能別実装、結合・テスト
   - **タスク依存関係**: 順次実行対並列実行ルール
   - **タスク詳細**: ID、説明、ファイルパス、並列マーカー[P]
   - **実行フロー**: 順序と依存関係の要件

3. タスク計画に従って実装を実行してください：
   - **タスクごとの実行**: 次のタスクに進む前に各タスクを完了
   - **セットアップタスク**: リソース配置（画像ファイルのコピー等）を最優先で実行
   - **依存関係の尊重**: 順次タスクは順番に実行、並列タスク[P]は一緒に実行可能
   - **TDDアプローチに従う**: 対応する実装の前にテストを実行
   - **ファイルベースの調整**: 同じファイルに影響するタスクは順次実行必須
   - **検証チェックポイント**: 進む前に各タスクの完了を検証

4. 実装実行ルール：
   - **プロジェクトルートの明示**: プロジェクトルートは外部から明示的に指定されます。全てのパス操作はこのプロジェクトルートを基準に行います
   - **憲章の遵守**: `<プロジェクトルート>/memory/` 配下の憲章に記載された開発原則を全ての実装で遵守
     - テストカバレッジ基準、アーキテクチャパターン、コーディング規約に従う
     - 品質基準、セキュリティ要件、パフォーマンス基準を満たす
   - **セットアップ優先**: プロジェクト構造、依存関係、構成を初期化
     - **画像リソースの配置**: `<プロジェクトルート>/images/covers/` の全ての画像ファイルを `<プロジェクトルート>/src/main/webapp/resources/covers/` にコピー
     - 必須画像: no-image.jpg（画像が存在しない書籍用のデフォルト画像）
     - 画像ファイル名は書籍名と対応（例: "Java SEディープダイブ.jpg"）
   - **コードの前にテスト**: 契約、エンティティ、結合シナリオのテストを作成（TDDの場合）
   - **コア開発**: モデル、サービス、CLIコマンド、エンドポイントを実装
   - **結合作業**: データベース接続、ミドルウェア、ロギング、外部サービス
   - **仕上げと検証**: ユニットテスト、パフォーマンス最適化、ドキュメント

5. アーキテクチャと設計ドキュメントを参照してください：
   - **architecture_design.md** が提供するもの：
     - 技術スタックとバージョン
     - アーキテクチャパターンとレイヤー
     - パッケージ構造規約
     - 適用するデザインパターン
     - トランザクションと並行制御戦略
     - セキュリティアーキテクチャ
     - データベース構成
   
   - **functional_design.md** が提供するもの：
     - 具体的なクラス名と責務
     - メソッドシグネチャと動作
     - ビジネスロジックとルール
     - ユーザーフローと画面遷移
     - データフローとシーケンス図
     - エラーハンドリングシナリオ

6. 進捗追跡とエラーハンドリング：
   - 完了した各タスク後に進捗を報告
   - 順次実行タスクが失敗した場合は実行を停止
   - 並列実行タスク[P]の場合、成功したタスクを続行し、失敗したタスクを報告
   - デバッグのためのコンテキスト付きの明確なエラーメッセージを提供
   - 実装を続行できない場合は次の手順を提案
   - **重要**: 完了したタスクについては、tasks.mdファイルでタスクを[X]としてマーク

7. 完了検証：
   - 憲章の原則と品質基準が遵守されていることを確認
   - 全ての必須タスクが完了していることを確認
   - 実装された機能が要件定義と一致することを確認
   - テストがパスし、カバレッジが要件を満たすことを検証
   - 実装がアーキテクチャ設計に従っていることを確認
   - クラス設計が機能設計仕様と一致することを検証
   - 画像リソースが正しく配置されていることを確認（`<プロジェクトルート>/images/covers/` → `<プロジェクトルート>/src/main/webapp/resources/covers/`）
   - 完了した作業の要約とともに最終ステータスを報告
   - **このタスクファイルのタスクがすべて完了したら、ここで停止する**

注意: 
- このインストラクションは、タスクリストに完全なタスク分解が存在することを前提としています。タスクが不完全または欠落している場合は、まず `@instructions/generate_tasks.md` を使用してタスクリストを生成することを提案してください。
- **指定されたタスクファイルのタスクのみを実行してください。他のタスクファイル（例: 次の機能のタスク）に自動的に進んではいけません。**
- タスクは分業の単位です。1つのタスクが完了したら、次のタスクに進む前にユーザーの確認を待ってください。

